import sqlite3
conn = sqlite3.connect('data.db')
cur = conn.cursor()

# для задание № 2
# 2 варианта нахождения конверсии
cur.execute("select (succses.totalcount*1.0)/(succses.totalcount+no_succes.totalcount) from (select count(hit_status_result_id) as totalcount from action where hit_status_result_id=3) as succses, (select count(hit_status_result_id) as totalcount from action where hit_status_result_id=1) as no_succes;")
result = cur.fetchone()
print('Продажная конверсия: ',result)
cur.execute("select count(hit_status_result_id) from action where hit_status_result_id=3;")
result_succses = cur.fetchone()
cur.execute("select count(hit_status_result_id) from action where hit_status_result_id=1;")
result_no_succses = cur.fetchone()
conversion = result_succses[0]/(result_succses[0]+result_no_succses[0])
print(f'Общее кол-во звонков со статусом успешно: {result_succses[0]}')
print(f'Продажная конверсия {conversion}')
cur.execute("select sum(duratoin_sec)/count(duratoin_sec) from call,action where wo_hit_rk = hit_rk and hit_status_result_id=3;")#ну или avg(duratoin_sec)
call_time = cur.fetchone()
print(f'Средняя длительность одной коммуникации, закрытой статусом «Дозвон, Успешно»: {call_time}')